(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{184:function(e,t,r){},618:function(e,t,r){},619:function(e,t,r){"use strict";r.r(t);var n=r(0),a=r.n(n),c=r(58),s=r.n(c),o=(r(184),r(1)),u=r.n(o),i=r(15),l=r(11),p=r(20),d=r(86),b=r(169),j=r.n(b),m=window.location,f=m.protocol,O=m.hostname,v=m.port,h="".concat(f,"//").concat(O,":").concat("3000"===v?8e3:v),x="".concat(h,"/api"),g=j.a.create({baseURL:"".concat(x,"/room"),responseType:"json"});function y(e){return w.apply(this,arguments)}function w(){return(w=Object(l.a)(u.a.mark((function e(t){var r,n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.roomId,n=t.creator,e.next=3,g.post("/create/".concat(r),{name:n.name,email:n.email});case 3:return a=e.sent,e.abrupt("return",a.data);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return C.apply(this,arguments)}function C(){return(C=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/rtp-capabilities/".concat(t));case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return N.apply(this,arguments)}function N(){return(N=Object(l.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.get("/transport/create/".concat(t));case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,t){return R.apply(this,arguments)}function R(){return(R=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.post("/transport/connect/".concat(t),{dtlsParameters:r});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e,t){return F.apply(this,arguments)}function F(){return(F=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.post("transport/produce/".concat(t),Object(i.a)({},r));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e,t){return _.apply(this,arguments)}function _(){return(_=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.post("transport/consume/".concat(t),Object(i.a)({},r));case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e,t){return E.apply(this,arguments)}function E(){return(E=Object(l.a)(u.a.mark((function e(t,r){var n,a,c,s,o,p,b,j,m,f,O,v;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new d.Device,e.next=3,k(t);case 3:return a=e.sent,c=a.rtpCapabilities,e.next=7,n.load({routerRtpCapabilities:c});case 7:if(!n.canProduce("video")){e.next=21;break}return e.next=10,S(t);case 10:s=e.sent,o=s.transport,console.log(o),p=o._internal,b=o._data,j=p.transportId,m=b.dtlsParameters,f=b.iceCandidates,O=b.iceParameters,v=n.createSendTransport({id:j,dtlsParameters:m,iceCandidates:f,iceParameters:O}),console.log("send transport created"),v.on("connect",function(){var e=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dtlsParameters,e.next=3,P(j,n);case 3:r();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),v.on("produce",function(){var e=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.next=3,I(j,Object(i.a)({id:v.id},t));case 3:n=e.sent,r({id:n.id});case 5:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),v.produce({track:r.getVideoTracks()[0],encodings:[{maxBitrate:1e5},{maxBitrate:3e5},{maxBitrate:9e5}],codecOptions:{videoGoogleStartBitrate:1e3}});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function D(e){return J.apply(this,arguments)}function J(){return(J=Object(l.a)(u.a.mark((function e(t){var r,n,a,c,s,o,i,p,b,j,m,f,O,v,h,x,g,y,w,C;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new d.Device,e.next=3,k(t);case 3:return n=e.sent,a=n.rtpCapabilities,e.next=7,r.load({routerRtpCapabilities:a});case 7:return c=r.rtpCapabilities,e.next=10,T(t,{rtpCapabilities:c});case 10:return s=e.sent,o=s.transport,i=s.consumer,p=o._internal,b=o._data,j=p.transportId,m=b.iceParameters,f=b.iceCandidates,O=b.dtlsParameters,(v=r.createRecvTransport({id:j,dtlsParameters:O,iceCandidates:f,iceParameters:m})).on("connect",function(){var e=Object(l.a)(u.a.mark((function e(t,r){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.dtlsParameters,e.next=3,P(j,n);case 3:r();case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()),h=i._internal,x=i._data,g=h.producerId,y=x.rtpParameters,x.kind,e.next=23,v.consume({id:j,producerId:g,rtpParameters:y,kind:"video"});case 23:return w=e.sent,C=w.track,e.abrupt("return",new MediaStream([C]));case 26:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var M=r(170),L=r.n(M)()(h),U=r(44),A=r(2),G=function(e){var t=e.onSubmit,r=e.onJoin,a=Object(n.useState)(""),c=Object(p.a)(a,2),s=c[0],o=c[1],u=Object(n.useState)(""),i=Object(p.a)(u,2),l=i[0],d=i[1],b=Object(n.useState)(""),j=Object(p.a)(b,2),m=j[0],f=j[1],O=Object(n.useState)(""),v=Object(p.a)(O,2),h=v[0],x=v[1],g=Object(n.useCallback)((function(e){return o(e.target.value)}),[]),y=Object(n.useCallback)((function(e){return d(e.target.value)}),[]),w=Object(n.useCallback)((function(e){return f(e.target.value)}),[]),k=Object(n.useCallback)((function(e){return x(e.target.value)}),[]),C=Object(n.useCallback)((function(e){e.preventDefault(),t&&t({name:s,email:l,roomId:m})}),[l,s,t,m]),S=Object(n.useCallback)((function(e){e.preventDefault(),r&&r(h)}),[r,h]);return Object(A.jsxs)("div",{className:"lobby",children:[Object(A.jsx)("form",{className:"form mt-4",onSubmit:C,children:Object(A.jsxs)("fieldset",{children:[Object(A.jsx)("legend",{children:"Create Room"}),Object(A.jsxs)("div",{className:"form-group",children:[Object(A.jsx)("label",{htmlFor:"name",children:"Name"}),Object(A.jsx)("input",{className:"form-control",onChange:g,value:s,type:"text",id:"name"})]}),Object(A.jsxs)("div",{className:"form-group",children:[Object(A.jsx)("label",{htmlFor:"email",children:"Email"}),Object(A.jsx)("input",{className:"form-control",onChange:y,value:l,type:"email",id:"email"})]}),Object(A.jsxs)("div",{className:"form-group",children:[Object(A.jsx)("label",{htmlFor:"room",children:"Room"}),Object(A.jsx)("input",{className:"form-control",onChange:w,value:m,type:"text",id:"room"})]}),Object(A.jsx)("button",{className:"btn btn-success",type:"submit",children:"Submit"})]})}),Object(A.jsx)("form",{className:"form mt-5",onSubmit:S,children:Object(A.jsxs)("fieldset",{children:[Object(A.jsx)("legend",{children:"Join Room "}),Object(A.jsxs)("div",{className:"form-group",children:[Object(A.jsx)("label",{htmlFor:"name",children:"Room"}),Object(A.jsx)("input",{className:"form-control",onChange:k,value:h,type:"text",id:"name"})]}),Object(A.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Join"})]})})]})},V=r(179),$=r(172),q=r.n($),z=r(173),H=r.n(z),K=r(623),Q=r(622),W=function(e){var t=e.stream,r=e.peer,a=e.code,c=e.onCode,s=Object(n.useRef)(null),o=Object(n.useState)(""),u=Object(p.a)(o,2);u[0],u[1];Object(n.useEffect)((function(){s.current&&(console.log(t),s.current.srcObject=t,s.current.play(),r&&"producer"===r.type&&(s.current.muted=!0))}),[r,t]);var l=Object(n.useCallback)((function(e){c&&c(e.target.value)}),[c]),d={code:function(e){e.node;var t=e.inline,r=e.className,n=e.children,a=Object(V.a)(e,["node","inline","className","children"]),c=/language-(\w+)/.exec(r||"");return!t&&c?Object(A.jsx)(K.a,Object(i.a)({style:Q.a,language:c[1],PreTag:"div",children:String(n).replace(/\n$/,"")},a)):Object(A.jsx)("code",Object(i.a)({className:r},a))}};return Object(A.jsxs)("div",{className:"room",children:[r&&"producer"===r.type?Object(A.jsx)("textarea",{onChange:l}):a&&Object(A.jsx)("div",{className:"markdown",children:Object(A.jsx)(q.a,{children:a,components:d,plugins:[H.a]})}),Object(A.jsx)("video",{className:"video",ref:s})]})};r(618);var X=function(){var e=Object(U.c)((function(e){return e})),t=Object(U.b)(),r=Object(n.useState)(""),a=Object(p.a)(r,2),c=(a[0],a[1]),s=Object(n.useState)(""),o=Object(p.a)(s,2),d=o[0],b=o[1],j=Object(n.useState)(),m=Object(p.a)(j,2),f=m[0],O=m[1],v=Object(n.useState)(new MediaStream),h=Object(p.a)(v,2),x=h[0],g=h[1];Object(n.useEffect)((function(){L.on("code",(function(e){console.log("in.. ",e),O(e)}))}),[]);var w=Object(n.useCallback)(function(){var e=Object(l.a)(u.a.mark((function e(r){var n,a,s,o,l;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.name,a=r.email,s=r.roomId,e.next=3,y({roomId:s,creator:{name:n,email:a,type:"producer"}});case 3:(o=e.sent).room?(b(o.room.id),t({type:"add_user",payload:Object(i.a)(Object(i.a)({},o.room.createdBy),{},{type:"producer"})})):c(null===(l=o.error)||void 0===l?void 0:l.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[t]);Object(n.useEffect)((function(){""!==d&&L.emit("join",d)}),[d]);var k=Object(n.useCallback)((function(e){Object(l.a)(u.a.mark((function t(){var r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e),t.next=3,D(e);case 3:r=t.sent,b(e),g(r);case 6:case"end":return t.stop()}}),t)})))()}),[]),C=Object(n.useCallback)((function(e){L.emit("data",{room:d,code:e}),console.log("emit",e)}),[d]);return Object(n.useEffect)((function(){""!==d&&e.userReducer.user&&"producer"===e.userReducer.user.type&&Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getting stream"),e.next=3,navigator.mediaDevices.getUserMedia({video:!0});case 3:return t=e.sent,g(t),e.next=7,B(d,t);case 7:case"end":return e.stop()}}),e)})))()}),[d,e]),Object(A.jsx)("div",{className:"App",children:d?Object(A.jsx)(W,{code:f,onCode:C,peer:e.userReducer.user,stream:x}):Object(A.jsx)(G,{onJoin:k,onSubmit:w})})},Y=r(59),Z=r(178),ee=Object(Y.combineReducers)({userReducer:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"add_user":return Object(i.a)(Object(i.a)({},e),{},{user:Object(i.a)({},t.payload)});default:return e}}}),te=Object(Y.createStore)(ee,Object(Z.devToolsEnhancer)({})),re=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,624)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;r(e),n(e),a(e),c(e),s(e)}))};s.a.render(Object(A.jsx)(a.a.StrictMode,{children:Object(A.jsx)(U.a,{store:te,children:Object(A.jsx)(X,{})})}),document.getElementById("root")),re()}},[[619,1,2]]]);
//# sourceMappingURL=main.957fdb58.chunk.js.map